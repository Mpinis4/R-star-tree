Περίληψη Εργασίας

Στόχος της εργασίας είναι η υλοποίηση του R* tree που αποτελεί μία βελτίωση
του R tree για την οργάνωση και επεξεργασία δεδομένων χώρου( spatial
data). Το R* tree υποστηρίζει την υλοποίηση της εισαγωγής και διαγραφής
εγγραφών καθώς και βασικά ερωτήματα όπως ερωτήματα περιοχής ( range
queries), ερωτήματα πλησιέστερων γειτόνων (k-nearest neighbor queries),
ερωτήματα κορυφογραμμής (Skyline queries) και μαζικής κατασκευής του
καταλόγου.

Η εργασία υλοποιήθηκε στην προγραμματιστική γλώσσα Java. Η κύρια δομή
R* tree αποτελεί μία κλάση του προγράμματος που εμπεριέχει σαν
συναρτήσεις το ερώτημα περιοχής, το ερώτημα του πλησιέστερου γείτονα, το
ερώτημα κορυφογραμμής και μαζικής κατασκευής του καταλόγου. Για την
υλοποίηση της δομής χρειάστηκαν και βοηθητικές κλάσεις που αποτελούν τα
επιμέρους στοιχεία του δένδρου.

ΚΛΑΣΕΙΣ ΧΑΡΑΚΤΗΡΙΣΤΙΚΩΝ ΔΕΝΔΡΟΥ

Node

Η κλάση, υλοποιεί τον κόμβο του R* tree. Κάθε κόμβος αποτελείται από
διάφορα records και έχουμε υλοποιήσει τις ανάλογες συναρτήσεις για την
αναπροσαρμογή του MBR που δέχονται σαν όρισμα ένα αντικείμενο τύπου
Record ή Node και ορίζουν το ανάλογο MBR για κάθε Node.

Entry

Η κλάση Entry υλοποιεί τα στοιχεία που παίρνουμε από το osm file και τα
αποθηκεύουμε στο datafile. Για κάθε entry στοιχείο έχουμε ένα String id που
για κάθε εγγραφή είναι μοναδικό και τις συντεταγμένες latitude και longitude
που αποθηκεύονται σε ένα ArrayList και ένα String name. Επίσης έχουμε 2
κατασκευαστές, στους οποίους ο ένα έχει ορίσματα ένα String id, ArrayList με
τις συντεταγμένες και String name, ενώ ο δεύτερος κατασκευαστής δεν έχει
ως όρισμα το name, σε περίπτωση που το τελευταίο είναι null στο osm file.
Τέλος, έχουμε συναρτήσεις getters για το id, το name, και τις συντεταγμένες.

Record

Κάθε κόμβος σε ένα R* tree αποτελείται από διάφορες εγγραφές. Στην
εργασία, κάθε εγγραφή εκπροσωπείται από ένα μοναδικό id, τις
συντεταγμένες latitude και longitude και ένα μοναδικό όνομα. Επίσης, για κάθε
εγγραφή, αποθηκεύεται η σειρά του αρχείου που αποθηκεύεται η εγγραφή
καθώς και ένα blockid. Στην κλάση Record υπάρχει κατασκευαστής που
αρχικοποιεί τα ορίσματα id,info,line,blockid και name, καθώς και getters για τα
ορίσματα.

Records

Η κλάση αυτή υλοποιεί τις εγγραφές του δένδρου και είναι μία παραλλαγή της
κλάσης Record. Η χρήση της γίνεται αποκλειστικά για την υλοποίηση του
ερωτήματος πλησιέστερου γείτονα και ερωτήματος περιοχής, για αυτό
υπάρχει και η μεταβλητή distance(απόσταση) για να δηλώνει την απόσταση
μεταξύ των εγγραφών. Έχουμε 2 κατασκευαστές, ο ένας με ορίσματα id,
ArrayList coordinates, distance και ο δεύτερος χωρίς όρισμα distance στην
περίπτωση που η απόσταση είναι 0. Έχουμε συναρτήσεις getters για τις
μεταβλητές id, distance και coordinates καθώς και μία συνάρτηση

showObject() που εμφανίζει στο command line την εγγραφή.

showObject(): Η συνάρτηση είναι τύπου void και δεν δέχεται κάποιο όρισμα.

Διακρίνουμε 2 περιπτώσεις:

● Αν δεν ορίζεται το distance, τότε εμφανίζεται στο command line, το id
και οι συντεταγμένες της εγγραφής και
● Σε περίπτωση που έχουμε distance, εμφανίζεται το id, οι συντεταγμένες
και η απόσταση μεταξύ εγγραφών.

ΚΛΑΣΕΙΣ ΕΡΩΤΗΜΑΤΩΝ ΣΕΙΡΙΑΚΗΣ ΑΝΑΖΗΤΗΣΗΣ

SerialManager

Είναι η κλάση που είναι υπεύθυνη για την κλήση των κλάσεων ερωτημάτων
καθώς επίσης για την καταγραφή και εμφάνιση του χρόνου εκτέλεσης των
ερωτημάτων.

NearestNeighboursQuery

Σε αυτή την κλάση υλοποιείται ο αλγόριθμος του πλησιέστερου γείτονα.
Έχουμε ένα κατασκευαστή που δέχεται τα ορίσματα diastasis, έναν ακέραιο k,
και ένα List από double με τις συντεταγμένες των record και μία συνάρτηση
CalculateKNN() που υπολογίζει τους πλησιέστερους γείτονες με σειριακή
μέθοδο αναζήτησης στις εγγραφές που είναι αποθηκευμένες μέσα στο
datafile.

CalculateKNN(): Η συνάρτηση είναι τύπου void και δεν δέχεται κάποιο όρισμα.

RangeQuery

Σε αυτή την κλάση υλοποιείται ο αλγόριθμος της περιοχής ερωτήματος.
Έχουμε ένα κατασκευαστή που δέχεται τα ορίσματα diastasis και ένα List από
double με τις συντεταγμένες των record και μία συνάρτηση RQ() που
υπολογίζει την περιοχή ενδιαφέροντος.

RQ(): Η συνάρτηση είναι τύπου void και δεν δέχεται κάποιο όρισμα.

ΚΛΑΣΗ Rstar Tree

Στην κλάση Rstar Tree αναπαρίσταται η δομή δεδομένων του Rstar tree.
Περιέχει μεθόδους για εισαγωγή νέων εγγραφών στο δένδρο, διαγραφή
εγγραφών, καθώς και εκτέλεσης ερωτήματος περιοχής (Range Query) και
πλησιέστερων γειτόνων (K nearest neighbors) στο δένδρο.

Συναρτήσεις:

InsertNewEntry(): Αυτή η μέθοδος χρησιμοποιείται για την εισαγωγή μιας νέας
εγγραφής με δεδομένες συντεταγμένες και ένα ID στο R*-δέντρο. Πρώτα
ενημερώνει το αρχείο XML και στη συνέχεια εκτελεί ορισμένες λειτουργίες στη
δομή R*-tree.

RangeQuery():Αυτή η μέθοδος εκτελεί ένα ερώτημα περιοχής στο R*-δέντρο
για την ανάκτηση εγγραφών που εμπίπτουν σε ένα καθορισμένο εύρος
συντεταγμένων.

kNNQuery():Αυτή η μέθοδος εκτελεί ένα ερώτημα k-πλησιέστερου γείτονα
(kNN) στο δέντρο R* για να ανακτήσει τις k πλησιέστερες εγγραφές σε ένα
δεδομένο σημείο.

BuildRstarTree():Αυτή η μέθοδος δημιουργεί τη δομή R*-tree διαβάζοντας
δεδομένα από το datafile και εισάγοντας εγγραφές στο δέντρο. Χρησιμοποιεί
μια depth-first traversal για να εισάγει εγγραφές στους κατάλληλους κόμβους.

Insert():Αυτή η συνάρτηση καλείται για να εισαγάγει μια νέα εγγραφή στο
δέντρο R*. Επιλέγει το κατάλληλο υποδέντρο για εισαγωγή και χειρίζεται το
overflow καλώντας το OverflowTreatment.

Get_Metadata():Αυτή η μέθοδος διαβάζει τα metadata σχετικά με το αρχείο
δεδομένων, όπως τον αριθμό των μπλοκ, τα μεγέθη μπλοκ και τις γραμμές σε
κάθε μπλοκ.
WriteIndexFile():Αυτή η μέθοδος είναι υπεύθυνη για την κατασκευή ενός
indexfile με βάση τη δομή R*-tree. Εκτελεί μια πρώτη διέλευση από το πλάτος
του δέντρου και γράφει πληροφορίες σχετικά με τους κόμβους στο indexfile.

Bfs(): Αυτός είναι ένας breadth-first traversal algorithm (BFS) για να
επισκεφθείτε όλους τους κόμβους στο δέντρο R* και να γράφει τα στοιχεία
τους στο indexfile
ChooseSubtree():Αυτή η μέθοδος επιλέγει το κατάλληλο υποδέντρο για την
εισαγωγή μιας νέας εγγραφής. Εξετάζει εάν ο τρέχων κόμβος είναι φύλλο και
αν όχι, επιλέγει το παιδί με τη μικρότερη μεγέθυνση περιοχής ή μεγέθυνση
επικάλυψης, ανάλογα με το αν τα παιδιά είναι φύλλα ή μη. για να επισκεφθεί
όλους τους κόμβους στο R*-tree και να γράψει τα στοιχεία τους στο indexfile.

SkylineQuery():Αυτή η συνάρτηση εκτελεί ένα ερώτημα skyline στο R*-δέντρο.
Παίρνει τον αριθμό των διαστάσεων ως παράμετρο και βρίσκει σημεία skyline
μέσα στο δέντρο.
Αρχικοποιεί μια κενή λίστα που ονομάζεται skylineResult για την αποθήκευση
των εγγραφών του skyline.
Μετρά τον χρόνο εκτέλεσης χρησιμοποιώντας System.nanoTime() πριν και
μετά το ερώτημα.
Καλεί τη συνάρτηση SkylineHelper για να εκτελέσει το πραγματικό skyline
query.
Τέλος, εκτυπώνει τα σημεία skyline και τον χρόνο εκτέλεσης του ερωτήματος.

SkylineHelper():Αυτή είναι μια αναδρομική βοηθητική συνάρτηση για το
ερώτημα του skyline. Διασχίζει το δέντρο, ελέγχει τις εγγραφές κάθε κόμβου
σε σχέση με τον τρέχοντα skyline και προσθέτει σημεία skyline στη λίστα
αποτελεσμάτων.
Εάν ο κόμβος είναι κόμβος φύλλου, ελέγχει κάθε εγγραφή στον κόμβο και την
προσθέτει στο αποτέλεσμα της γραμμής ορίζοντα εάν είναι skyline point.
Εάν ο κόμβος έχει παιδιά, καλεί αναδρομικά το SkylineHelper για κάθε παιδί.

Dominates():Αυτή η συνάρτηση υπολογίζει τη σχέση κυριαρχίας μεταξύ δύο
εγγραφών. Συγκρίνει τις τιμές κάθε διάστασης για να προσδιορίσει αν η μία
κυριαρχεί στην άλλη.
bottomUpRstarTreeBuild(): Αυτή η συνάρτηση κατασκευάζει το R*-δέντρο
χρησιμοποιώντας μια bottom up προσέγγιση.
Χρησιμοποιεί τη λειτουργία bulkLoad για τη φόρτωση δεδομένων και τη
δημιουργία κόμβων φύλλων.
Επαναληπτικά κάνει merge ομάδες κόμβων φύλλων σε γονικούς κόμβους
μέχρι να παραμείνει ένας μόνο κόμβος ρίζας.
Ο ριζικός κόμβος που προκύπτει αντιπροσωπεύει το πλήρες R*-δέντρο.

bulkLoad():Αυτή η συνάρτηση φορτώνει δεδομένα από ένα αρχείο, τα
οργανώνει σε κόμβους και επιστρέφει μια λίστα κόμβων. Βασικά σημεία:
Αναλύει το αρχείο εισόδου και εξάγει εγγραφές και metadata.
Δημιουργεί κόμβους για κάθε εγγραφή, προσθέτει εγγραφές σε κόμβους και
προσαρμόζει τα ελάχιστα οριοθετημένα ορθογώνια των κόμβων (MBR).
createParentNode(List<Node> children): Αυτή η συνάρτηση είναι υπεύθυνη
για την συνένωση των κόμβων και δημιουργία μεγαλύτερων σε ιεραρχία
κόμβων( γονείς) και συσχέτιση μεταξύ τους.

ΚΛΑΣΕΙΣ ΑΡΧΕΙΩΝ

FileOperations
Στην κλάση FileOperations διαβάζουμε το αρχείο osm, επεξεργαζόμαστε τα
χωρικά δεδομένα και τα αποθηκεύουμε σε ένα αρχείο για χρήση

Συναρτήσεις:

Parsing(): Η συνάρτηση είναι τύπου void και δεν δέχεται κάποιο όρισμα.
Αρχικά διαβάζει το osm file και δημιουργεί ένα αντικείμενο με όνομα nodeList
της κλάσης NodeList όπου παρέχει σε σειρά τους κόμβους του αρχείου.
Ύστερα μέσα σε μία for και όσο είναι το length του nodeList και διαβάζουμε
από τους κόμβους τις περιγραφές των δεδομένων, το id, το lat και το lon και
τα αποθηκεύομε σε αντίστοιχα Strings. Επίσης δημιουργούμε το αντικείμενο
tagList της κλάσης NodeList και όσο είναι το tag length του osm file
διαβάζουμε από την επιγραφή tag το όνομα( αν αυτό υπάρχει) και το
αποθηκεύουμε σε ένα String.
Τέλος, τις συντεταγμένες lat και lon που διαβάσαμε τα αποθηκεύουμε σε ένα
ArrayList και ύστερα διακρίνουμε 2 περιπτώσεις:

● Αν το name=null από το αρχείο που διαβάσαμε, τοτε αποθηκεύουμε τα
στοιχεία σε κατασκευαστή Entry που δεν έχει name ως όρισμα,

● Στην περίπτωση που name δεν είναι null, αποθηκεύουμε τα στοιχεία σε
ένα κατασκευαστή της κλάσης Entry που δέχεται το name ως όρισμα.
writeDataFile(): Η συνάρτηση είναι τύπου void και δεν δέχεται κάποιο όρισμα.
Αρχικά δημιουργούμε ένα file με όνομα datafile. Στην συνέχεια δημιουργούμε
ένα αντικείμενο της κλάσης Buffered Writer ώστε να γράψουμε στο datafile τις
εγγραφές του osm file. Επίσης έχουμε τις μεταβλητές length, block, line,
totalBytes, και bytesLeft, όπου blocks το αρχικοποιούμε σε 1 αφόυ στο
datafile αρχίζουμε από το πρώτο block. Κάθε block περιέχει κάποια records
ανάλογα με το μέγεθος των στοιχείου του κάθε record και μπορεί να είναι
μεγέθους έως 32KB. Μέσα σε μία for each παίρνουμε τα entries από το
ArrayList με entries που αποθηκεύσαμε όταν διαβάσαμε και επεξεργαστήκαμε
στο osm file στην συνάρτηση Parsing(), και αποθηκεύουμε στην μεταβλητή
temp το id, τα coordinates και το name( αν υπάρχει) και επιστρέφουμε το
μέγεθος σε bytes αυτών. Στην συνέχεια, στη μεταβλητή block0, όπου
αποθηκεύουμε πληροφορίες όπως το πλήθος των εγγραφών του αρχείου και
το μέγεθος των block, αποθηκεύουμε τον αριθμό των block, τις σειρές, και τα
bytes που έμειναν μετά την αποθήκευση της εγγραφής και με την χρήση του
buffer γράφουμε στο datafile το block0 και τα blocks που διαβάσαμε. Τέλος,
στο datafile γράφουμε την κάθε εγγραφή που διαβάσαμε, δηλαδή το id, τα lan
και lon και το name( αν αυτό υπάρχει).

ΕΙΔΙΚΕΣ ΚΛΑΣΕΙΣ

AppMenu

Στην κλάση AppMenu δημιουργείται το interface μεταξύ χρήστη και
προγράμματος.

throwMenu(): Η συνάρτηση αυτή είναι τύπου void και δεν δέχεται κάποιο
όρισμα. Αρχικά, και αφού καλοσορίσει τον χρήστη, του δίνει την δυνατότηα να
επιλέξει το χτίσιμο του R* δένδρου, και αυτόματα να συνεχίσει παρακάτω, ή
να σταματήσει το πρόγραμμα και να αποχωρήσει. Στην περίπτωση της
πρώτης επιλογής, το interface με μία switch συνάρτηση, ζητάει από τον
χρήστη τον αριθμό των διαστάσεων και το όνομα του αρχείου όπου θα γίνει η
επεξεργασία και η αποθήκευση των χωρικών δεδομένων (στην περίπτωση
μας, το μοναδικό αρχείο είναι το osm.map).Επίσης του δίνει την δυνατότητα
να σταματήσει το πρόγραμμα αν το θελήσει. Στην συνέχεια, και εφόσον ο
χρήστης έδωσε τον αριθμό των διαστάσεων και το όνομα του αρχείου, το
πρόγραμμα διαβάζει, επεξεργάζεται και αποθηκεύει τα δεδομένα στο datafile,
και από το datafile χτίζεται το R* tree αποθηκεύοντας το στο indexfile. Εφόσον
τελειώσει αυτό το κομμάτι, το πρόγραμμα ενημερώνει τον χρήστη ότι το
δένδρο είναι έτοιμο και του παρουσιάζει τις επόμενες επιλογές που μπορεί να
διαλέξει. Χρησιμοποιώντας μια switch,οι επιλογές είναι οι εξής

1. η εισαγωγή νέας εγγραφής
2. η διαγραφή εγγραφής
3. η αναζήτηση όλων των σημείων σε μία περιοχή( χρήση του
ερωτήματος περιοχής),
4. η εύρεση των k πλησιέστερων γειτόνων από μια εγγραφή( ερώτημα
πλησιέστερων γειτόνων),
5. η εύρεση κορυφογραμμής(Skyline Query)
6. η κατασκευή R* tree με την μέθοδο bottom-up
7. Τίποτα από τα παραπάνω και να τερματίσει το πρόγραμμα

Ανάλογα με την επιλογή του χρήστη συνεχίζουμε αναλόγως:

1. Αν ο χρήστης επιλέξει την επιλογή 1, το πρόγραμμα ζητάει από τον
τελευταίο να εισάγει το καινούργιο id καθώς και τις συντεταγμένες του
σημείου. Αν τα στοιχεία που έδωσε ο χρήστης είναι έγκυρα, τότε
προστίθεται στο datafile η νέα εγγραφή και ενημερώνει ότι η εισαγωγή
εκτελέστηκε με επιτυχία.
2. Στην επιλογή 2, το πρόγραμμα ζητάει από τον χρήστη να εισάγει το id
της εγγραφής που επιθυμεί να διαγραφεί. Αν το id υπάρχει στο datafile,
τότε διαγράφεται ολόκληρη η εγγραφή από το αρχείο, ενώ στην
περίπτωση που το id δεν είναι έγκυρο, το πρόγραμμα σταματάει και
εμφανίζει error.
3. Στην επιλογή 3, το πρόγραμμα ζητάει από τον χρήστη να εισάγει 2
ζευγάρια συντεταγμένων, όπου το πρώτο ζευγάρι είναι το ελάχιστο όριο
και το δεύτερο ζευγάρι είναι το μέγιστο όριο της περιοχής όπου
αναζητάμε στοιχεία. Αν τα ζευγάρια συντεταγμένων που έδωσε ο
χρήστης είναι σε εφαρμόσιμα πλαίσια, τότε το πρόγραμμα εμφανίζει
όλες τις εγγραφές στην περιοχή που ζήτησε ο χρήστης καθώς και τους
χρόνους κατασκευής του R*tree και της υλοποίησης του ερωτήματος
περιοχής.
4. Στην επιλογή 4, το πρόγραμμα ζητάει από τον χρήστη να εισάγει τον
αριθμό k πλησιέστερων γειτόνων και τις συντεταγμένες της εγγραφής
όπου θα εκτελεστεί ο αλγόριθμος. Αν οι συντεταγμένες είναι έγκυρες θα
εμφανιστούν k εγγραφές με τις συντεταγμένες καθώς και οι χρόνοι
κατασκευής του R*tree και της υλοποίησης του ερωτήματος k
πλησιέστερων γειτόνων.
5. Στην επιλογή 5, το πρόγραμμα δεν ζητάει από τον χρήστη να εισάγει
κάτι, απλά εκτελείται το ερώτημα της κορυφογραμμής και εμφανίζονται
όλες οι εγγραφές που δεν κυριαρχούνται ή κυριαρχούνται ασθενά,
καθώς και οι χρόνοι εκτέλεσης του προγράμματος.
6. Στην επιλογή 6, το πρόγραμμα κατασκευάζει το R* δένδρο με την
τεχνική του bottom up και εμφανίζει τους χρόνους εκτέλεσης της
κατασκευής του δένδρου.
7. Στην επιλογή 7, το πρόγραμμα τερματίζει.

Main

Στην συνάρτηση main καλείται απλά ένα αντικείμενο της AppMenu και η
συνάρτηση throwMenu().
